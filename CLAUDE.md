<!-- OPENSPEC:START -->
# OpenSpec Instructions

These instructions are for AI assistants working in this project.

Always open `@/openspec/AGENTS.md` when the request:
- Mentions planning or proposals (words like proposal, spec, change, plan)
- Introduces new capabilities, breaking changes, architecture shifts, or big performance/security work
- Sounds ambiguous and you need the authoritative spec before coding

Use `@/openspec/AGENTS.md` to learn:
- How to create and apply change proposals
- Spec format and conventions
- Project structure and guidelines

Keep this managed block so 'openspec update' can refresh the instructions.

<!-- OPENSPEC:END -->

# CLAUDE.md - Nuxt 4 æ¨¡æ¿é¡¹ç›®

## é¡¹ç›®æ„¿æ™¯

è¿™æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„ Nuxt 4 å…¨æ ˆåº”ç”¨æ¨¡æ¿ï¼Œé›†æˆäº†å½“å‰æœ€ä½³çš„æŠ€æœ¯æ ˆå’Œå¼€å‘å®è·µã€‚é¡¹ç›®æ—¨åœ¨ä¸ºå¿«é€Ÿå¯åŠ¨æ–°é¡¹ç›®æä¾›åšå®çš„åŸºç¡€ï¼ŒåŒ…å«å®Œæ•´çš„å‰ç«¯ UIã€åç«¯ APIã€æ•°æ®åº“é›†æˆã€å›½é™…åŒ–æ”¯æŒå’Œè‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹ã€‚

## æ¶æ„æ€»è§ˆ

### æŠ€æœ¯æ ˆ

- **å‰ç«¯æ¡†æ¶**: Nuxt 4 + Vue 3 + TypeScript
- **UI ç»„ä»¶**: Nuxt UI + Tailwind CSS 3 + æ·±è‰²æ¨¡å¼
- **çŠ¶æ€ç®¡ç†**: Pinia
- **ç±»å‹å®‰å…¨ API**: tRPC + Zod
- **æ•°æ®åº“**: Drizzle ORM + Cloudflare D1 (ç”Ÿäº§) + SQLite (å¼€å‘)
- **å›½é™…åŒ–**: @nuxtjs/i18n (ä¸­è‹±åŒè¯­)
- **å·¥å…·åº“**: date-fns + radash + VueUse (SSR å…¼å®¹ç‰ˆæœ¬)
- **ä»£ç è´¨é‡**: ESLint + Prettier (æ ¼å¼åŒ– + æ£€æŸ¥)
- **éƒ¨ç½²**: Cloudflare Pages + GitHub Actions

### æ¶æ„ç‰¹ç‚¹

- **å…¨æ ˆ TypeScript**: ä»å‰ç«¯åˆ°åç«¯çš„å®Œæ•´ç±»å‹å®‰å…¨
- **SSR/SSG æ”¯æŒ**: æœåŠ¡ç«¯æ¸²æŸ“å’Œé™æ€ç”Ÿæˆçµæ´»åˆ‡æ¢
- **å“åº”å¼è®¾è®¡**: ç§»åŠ¨ç«¯ä¼˜å…ˆçš„è‡ªé€‚åº”å¸ƒå±€
- **æ¨¡å—åŒ–ç»“æ„**: æ¸…æ™°çš„ä»£ç ç»„ç»‡å’Œåˆ†å±‚æ¶æ„
- **å¼€å‘ä½“éªŒ**: çƒ­é‡è½½ã€è‡ªåŠ¨å¯¼å…¥ã€ç±»å‹æç¤º

## âœ¨ æ¨¡å—ç»“æ„å›¾

```mermaid
graph TD
    A["(æ ¹) Nuxt 4 æ¨¡æ¿é¡¹ç›®"] --> B["app"]
    A --> C["server"]
    A --> D["components"]
    A --> E["i18n"]
    A --> F["migrations"]
    A --> G["é…ç½®æ–‡ä»¶"]

    B --> B1["components"];
    B --> B2["pages"];
    B --> B3["composables"];
    B --> B4["utils"];
    B --> B5["layouts"];

    C --> C1["api"];
    C --> C2["trpc"];
    C --> C3["lib"];
    C --> C4["scripts"];

    D --> D1["ui"];

    E --> E1["locales"];

    F --> F1["æ•°æ®åº“è¿ç§»æ–‡ä»¶"];

    G --> G1["nuxt.config.ts"];
    G --> G2["drizzle.config.ts"];
    G --> G3["eslint.config.js"];

    click B "./app/CLAUDE.md" "æŸ¥çœ‹ app æ¨¡å—æ–‡æ¡£"
    click C "./server/CLAUDE.md" "æŸ¥çœ‹ server æ¨¡å—æ–‡æ¡£"
    click D "./components/CLAUDE.md" "æŸ¥çœ‹ components æ¨¡å—æ–‡æ¡£"
    click E "./i18n/CLAUDE.md" "æŸ¥çœ‹ i18n æ¨¡å—æ–‡æ¡£"
    click F "./migrations/CLAUDE.md" "æŸ¥çœ‹ migrations æ¨¡å—æ–‡æ¡£"
```

## æ¨¡å—ç´¢å¼•

| æ¨¡å—è·¯å¾„      | ç±»å‹     | èŒè´£æè¿°                                        | ä¸»è¦æ–‡ä»¶                                                  |
| ------------- | -------- | ----------------------------------------------- | --------------------------------------------------------- |
| `app/`        | å‰ç«¯åº”ç”¨ | Nuxt 4 æ ¸å¿ƒåº”ç”¨ç›®å½•ï¼ŒåŒ…å«é¡µé¢ã€ç»„ä»¶ã€ç»„åˆå¼å‡½æ•° | `app.vue`, `pages/`, `components/`, `composables/`        |
| `server/`     | åç«¯æœåŠ¡ | æœåŠ¡ç«¯ APIã€tRPC è·¯ç”±ã€æ•°æ®åº“æ“ä½œ               | `api/`, `trpc/`, `lib/db.ts`, `lib/schema.ts`             |
| `components/` | UI ç»„ä»¶  | å…¨å±€ shadcn-vue ç»„ä»¶åº“                          | `ui/`, `button/`, `card/`, `input/`                       |
| `i18n/`       | å›½é™…åŒ–   | ä¸­è‹±æ–‡åŒè¯­æ”¯æŒé…ç½®                              | `locales/zh.json`, `locales/en.json`                      |
| `migrations/` | æ•°æ®åº“   | Drizzle ORM è¿ç§»æ–‡ä»¶                            | `.sql` æ–‡ä»¶, `meta/`                                      |
| `é…ç½®æ–‡ä»¶`    | é¡¹ç›®é…ç½® | å„ç§æ„å»ºå’Œå¼€å‘å·¥å…·é…ç½®                          | `nuxt.config.ts`, `drizzle.config.ts`, `eslint.config.js` |

## ç¼–ç è§„èŒƒ

### ä»£ç é£æ ¼

- ä½¿ç”¨ ESLint + Prettier è¿›è¡Œä»£ç æ ¼å¼åŒ–å’Œæ£€æŸ¥
- 2 ç©ºæ ¼ç¼©è¿›ï¼Œ100 å­—ç¬¦è¡Œå®½
- åŒå¼•å·å­—ç¬¦ä¸²ï¼Œå°¾éšé€—å·
- è‡ªåŠ¨å¯¼å…¥ï¼š`app/` ç›®å½•å†…çš„ç»„ä»¶ã€composablesã€utils

### å‘½åçº¦å®š

- **ç»„ä»¶**: PascalCase (å¦‚ `DemoCounter.vue`)
- **Composables**: use å¼€å¤´ (å¦‚ `useTRPC.ts`)
- **å·¥å…·å‡½æ•°**: camelCase (å¦‚ `formatRelativeTime`)
- **æ–‡ä»¶å**: kebab-case æˆ– camelCase

### ç›®å½•ç»„ç»‡åŸåˆ™

- **åº”ç”¨ç‰¹å®šä»£ç ** â†’ `app/` ç›®å½•
- **å…¨å±€å¯å¤ç”¨ä»£ç ** â†’ æ ¹ç›®å½•å¯¹åº”ç›®å½•
- **ç¬¬ä¸‰æ–¹åº“å°è£…** â†’ `lib/` ç›®å½•
- **é™æ€èµ„æº** â†’ `public/` æˆ– `app/assets/`

### Vue Reactivity æœ€ä½³å®è·µ

#### ref ä½¿ç”¨è§„èŒƒ

**âš ï¸ é‡è¦è§„åˆ™ï¼šç¦æ­¢åœ¨ `<script setup>` æˆ– `setup()` å‡½æ•°å¤–éƒ¨å®šä¹‰ `ref` çŠ¶æ€**

**é”™è¯¯ç¤ºä¾‹ï¼š**

```typescript
// âŒ é”™è¯¯ï¼šåœ¨ç»„ä»¶å¤–éƒ¨å®šä¹‰ ref
export const globalState = ref({
  count: 0,
  user: null,
})

// âŒ é”™è¯¯ï¼šåœ¨æ¨¡å—ä½œç”¨åŸŸå®šä¹‰ ref
const sharedState = ref({
  data: [],
})
```

**æ­£ç¡®ç¤ºä¾‹ï¼š**

```vue
<script setup>
// âœ… æ­£ç¡®ï¼šåœ¨ setup å‡½æ•°å†…éƒ¨å®šä¹‰ ref
const localState = ref({
  count: 0,
  user: null,
})

// âœ… æ­£ç¡®ï¼šåœ¨ composable å†…éƒ¨å®šä¹‰ ref
const useCounter = () => {
  const count = ref(0)

  const increment = () => {
    count.value++
  }

  return { count, increment }
}
</script>
```

**åŸå› è¯´æ˜ï¼š**

1. **å†…å­˜æ³„æ¼é£é™©**: åœ¨ SSR ç¯å¢ƒä¸­ï¼Œæ¨¡å—çº§åˆ«çš„ ref ä¼šåœ¨ä¸åŒè¯·æ±‚ä¹‹é—´å…±äº«çŠ¶æ€
2. **çŠ¶æ€æ±¡æŸ“**: å¤šä¸ªç”¨æˆ·æˆ–è¯·æ±‚å¯èƒ½å…±äº«åŒä¸€ä¸ªçŠ¶æ€ï¼Œå¯¼è‡´æ•°æ®æ··æ·†
3. **æœåŠ¡å™¨ç«¯æ¸²æŸ“é—®é¢˜**: æœåŠ¡ç«¯æ¸²æŸ“æ—¶çŠ¶æ€ä¼šæ„å¤–æŒä¹…åŒ–ï¼Œå½±å“åç»­è¯·æ±‚

**æ›¿ä»£æ–¹æ¡ˆï¼š**

1. **ç»„ä»¶å†…éƒ¨çŠ¶æ€**: åœ¨ç»„ä»¶çš„ `<script setup>` å†…éƒ¨å®šä¹‰ ref
2. **çŠ¶æ€ç®¡ç†**: ä½¿ç”¨ Pinia è¿›è¡Œå…¨å±€çŠ¶æ€ç®¡ç†
3. **ç»„åˆå¼å‡½æ•°**: å°†çŠ¶æ€é€»è¾‘å°è£…åœ¨ composable ä¸­

**æ£€æŸ¥æ¸…å•ï¼š**

- [ ] æ‰€æœ‰ ref éƒ½åœ¨ `<script setup>` æˆ– `setup()` å‡½æ•°å†…éƒ¨å®šä¹‰
- [ ] æ²¡æœ‰åœ¨æ¨¡å—çº§åˆ«å¯¼å‡º ref å˜é‡
- [ ] å…¨å±€çŠ¶æ€é€šè¿‡ Pinia ç®¡ç†
- [ ] ç»„åˆå¼å‡½æ•°åœ¨å†…éƒ¨åˆ›å»ºå’Œç®¡ç†çŠ¶æ€

## AI ä½¿ç”¨æŒ‡å¼•

### é¡¹ç›®ç»“æ„ç†è§£

- è¿™æ˜¯ä¸€ä¸ª Nuxt 4 å…¨æ ˆåº”ç”¨ï¼Œé‡‡ç”¨æ–°çš„ `app/` ç›®å½•ç»“æ„
- å‰åç«¯å®Œå…¨ TypeScriptï¼Œé€šè¿‡ tRPC å®ç°ç±»å‹å®‰å…¨é€šä¿¡
- æ•°æ®åº“æ”¯æŒæœ¬åœ° SQLite å’Œç”Ÿäº§ç¯å¢ƒ Cloudflare D1
- ç»„ä»¶åˆ†ä¸ºåº”ç”¨çº§ (`app/components/`) å’Œå…¨å±€çº§ (`components/`)

### å¼€å‘å»ºè®®

1. **æ–°å¢é¡µé¢**: åœ¨ `app/pages/` åˆ›å»º `.vue` æ–‡ä»¶ï¼Œè·¯ç”±è‡ªåŠ¨ç”Ÿæˆ
2. **æ–°å¢ç»„ä»¶**: æ ¹æ®ä½œç”¨åŸŸé€‰æ‹© `app/components/` æˆ– `components/`
3. **API å¼€å‘**: åœ¨ `server/trpc/router.ts` å®šä¹‰è·¯ç”±ï¼Œåœ¨ `server/trpc/routes/` å®ç°
4. **æ•°æ®åº“æ“ä½œ**: ä½¿ç”¨ Drizzle ORMï¼Œä¿®æ”¹ `server/lib/schema.ts` åè¿è¡Œè¿ç§»
5. **æ ·å¼å¼€å‘**: ä½¿ç”¨ Tailwind CSS ç±»åï¼Œå‚è€ƒ shadcn-vue ç»„ä»¶å®ç°
6. **çŠ¶æ€ç®¡ç†**:
   - ç»„ä»¶çŠ¶æ€åœ¨ `<script setup>` å†…éƒ¨å®šä¹‰ ref
   - å…¨å±€çŠ¶æ€ä½¿ç”¨ Pinia store
   - **é¿å…**åœ¨æ¨¡å—çº§åˆ«å¯¼å‡º ref å˜é‡

### æ³¨æ„äº‹é¡¹

- `app/` ç›®å½•å†…çš„æ–‡ä»¶æ”¯æŒè‡ªåŠ¨å¯¼å…¥
- tRPC æä¾›å‰åç«¯ç±»å‹å®‰å…¨çš„ API é€šä¿¡
- æ•°æ®åº“é…ç½®æ”¯æŒå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨åˆ‡æ¢
- æ‰€æœ‰ UI ç»„ä»¶éƒ½æ”¯æŒæ·±è‰²æ¨¡å¼
- å›½é™…åŒ–æ–‡ä»¶éœ€è¦åŒæ—¶æ›´æ–°ä¸­è‹±æ–‡ç‰ˆæœ¬
- **é‡è¦**: é¡¹ç›®é€šè¿‡å…¼å®¹æ€§é€‚é…å±‚ç¡®ä¿ VueUse çš„ SSR å…¼å®¹æ€§
- **ğŸš¨ å…³é”®**: æ°¸è¿œä¸è¦åœ¨ `<script setup>` æˆ– `setup()` å‡½æ•°å¤–éƒ¨å®šä¹‰ `const state = ref()`ï¼Œè¿™ä¼šå¯¼è‡´ SSR ç¯å¢ƒä¸­çš„çŠ¶æ€å…±äº«å’Œå†…å­˜æ³„æ¼

## âš ï¸ å…³é”®ä¿®å¤è®°å½•

### VueUse SSR å…¼å®¹æ€§æ–¹æ¡ˆ

**é—®é¢˜èƒŒæ™¯ï¼š**
é¡¹ç›®åœ¨ä½¿ç”¨ VueUse åº“æ—¶é‡åˆ° Cloudflare Pages SSR ç¯å¢ƒå…¼å®¹æ€§é—®é¢˜ï¼Œä¸»è¦è¡¨ç°ä¸ºæ„å»ºå¤±è´¥å’Œè¿è¡Œæ—¶é”™è¯¯ã€‚

**æ ¹æœ¬åŸå› ï¼š**
VueUse åº“å¤§é‡ä¾èµ–æµè§ˆå™¨åŸç”Ÿ APIï¼ˆå¦‚ `window`, `document`, `navigator`ï¼‰ï¼Œè¿™äº› API åœ¨ Cloudflare Pages çš„æœåŠ¡ç«¯æ¸²æŸ“ç¯å¢ƒä¸­ä¸å¯ç”¨ï¼Œå¯¼è‡´ï¼š

- æ„å»ºæ—¶å‡ºç° `window is not defined` é”™è¯¯
- SSR æ¸²æŸ“å¤±è´¥
- éƒ¨ç½²ååº”ç”¨æ— æ³•æ­£å¸¸è¿è¡Œ

**è§£å†³æ–¹æ¡ˆï¼š**

1. **ä¿ç•™ VueUse æ ¸å¿ƒä¾èµ–**
   - ä¿ç•™é¡¹ç›®ä¸­å¯å®‰å…¨ä½¿ç”¨çš„ VueUse å‡½æ•°
   - ç»´æŒåŸæœ‰ API æ¥å£ä¸å˜

2. **åˆ›å»ºå…¼å®¹æ€§é€‚é…å±‚**
   åˆ›å»º `app/utils/vueuse.ts` æ–‡ä»¶ï¼Œæä¾› SSR å…¼å®¹çš„å®ç°ï¼š
   - `useMediaQuery`: ä½¿ç”¨ `window.matchMedia` åŸç”Ÿ API + å®¢æˆ·ç«¯æ£€æŸ¥
   - `useMouse`: ä½¿ç”¨åŸç”Ÿäº‹ä»¶ç›‘å¬å™¨ + ç¯å¢ƒéš”ç¦»
   - `useWindowSize`: ä½¿ç”¨ `window.addEventListener` + SSR å®‰å…¨
   - `useToggle`: ä½¿ç”¨ Vue 3 çš„ `ref` å®ç°çŠ¶æ€ç®¡ç†
   - `useDark`: è¯»å–æœ¬åœ°å­˜å‚¨å’Œç³»ç»Ÿåå¥½
   - `useClipboard`: ä½¿ç”¨ç°ä»£å‰ªè´´æ¿ API

3. **å®¢æˆ·ç«¯å®‰å…¨æ£€æŸ¥**
   - æ‰€æœ‰æ¶‰åŠ DOM API çš„æ“ä½œéƒ½å¢åŠ äº† `process.client` ç¯å¢ƒæ£€æŸ¥
   - ä½¿ç”¨ `onMounted` é’©å­ç¡®ä¿ç»„ä»¶æŒ‚è½½åå†æ‰§è¡Œ DOM æ“ä½œ
   - æ·»åŠ äº†å®Œå–„çš„é”™è¯¯è¾¹ç•Œå¤„ç†ï¼Œé¿å…æœåŠ¡ç«¯æ¸²æŸ“é”™è¯¯

**å…³é”®æ–‡ä»¶ï¼š**

- `app/utils/vueuse.ts` - VueUse åŠŸèƒ½çš„å…¼å®¹æ€§æ›¿ä»£å®ç°
- `app/components/demo/UtilityTest.vue` - å·¥å…·å‡½æ•°æµ‹è¯•å’Œæ¼”ç¤º
- `eslint.config.js` - ESLint é…ç½®ï¼Œå¿½ç•¥ UI ç»„ä»¶åº“æ–‡ä»¶

**æ–¹æ¡ˆæ•ˆæœï¼š**

- âœ… æ„å»ºæˆåŠŸï¼Œæ¶ˆé™¤æ‰€æœ‰ SSR ç›¸å…³é”™è¯¯
- âœ… åŠŸèƒ½å®Œæ•´ï¼Œä¿æŒåŸæœ‰ VueUse API ç‰¹æ€§
- âœ… ç¯å¢ƒéš”ç¦»ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½èƒ½æ­£å¸¸è¿è¡Œ
- âœ… éƒ¨ç½²æˆåŠŸï¼Œåœ¨ Cloudflare Pages æ­£å¸¸è¿è¡Œ

**ç»éªŒæ€»ç»“ï¼š**

1. **ç¯å¢ƒéš”ç¦»**: SSR é¡¹ç›®å¿…é¡»ä¸¥æ ¼åŒºåˆ†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç¯å¢ƒ
2. **æ¸è¿›å¢å¼º**: å…ˆç¡®ä¿åŸºç¡€åŠŸèƒ½å¯ç”¨ï¼Œå†æ·»åŠ å®¢æˆ·ç«¯å¢å¼ºç‰¹æ€§
3. **å…¼å®¹æ€§ä¼˜å…ˆ**: é€‰æ‹© SSR å‹å¥½çš„å®ç°æ–¹å¼ï¼Œç¡®ä¿éƒ¨ç½²æˆåŠŸ
4. **æµ‹è¯•éªŒè¯**: åœ¨æ„å»ºå’Œéƒ¨ç½²è¿‡ç¨‹ä¸­å……åˆ†æµ‹è¯• SSR å’Œå®¢æˆ·ç«¯æ¸²æŸ“

### ä»£ç è´¨é‡å·¥å…·é“¾è¿ç§»

**è¿ç§»èƒŒæ™¯ï¼š**
é¡¹ç›®ä» Biome ä»£ç è´¨é‡å·¥å…·è¿ç§»åˆ° ESLint + Prettier ç»„åˆï¼Œä»¥è·å¾—æ›´å¥½çš„ç”Ÿæ€ç³»ç»Ÿæ”¯æŒå’Œå›¢é˜Ÿåä½œä½“éªŒã€‚

**è¿ç§»å†…å®¹ï¼š**

1. **ç§»é™¤ Biome ä¾èµ–**
   - åˆ é™¤ `biome.json` é…ç½®æ–‡ä»¶
   - ç§»é™¤ç›¸å…³çš„ package.json è„šæœ¬

2. **å¼•å…¥ ESLint + Prettier**
   - ä½¿ç”¨ `@antfu/eslint-config` ä½œä¸ºåŸºç¡€é…ç½®
   - é›†æˆ TypeScriptã€Vueã€Nuxt è§„åˆ™æ”¯æŒ
   - é…åˆ Prettier è¿›è¡Œä»£ç æ ¼å¼åŒ–

3. **é…ç½®ä¼˜åŒ–**
   - å¿½ç•¥ UI ç»„ä»¶åº“æ–‡ä»¶ (`app/components/ui`, `components/ui`)
   - å¿½ç•¥ç”Ÿæˆæ–‡ä»¶å’Œæ„å»ºäº§ç‰©
   - æ”¯æŒ Vue 3 Composition API å’Œ Nuxt 4 ç‰¹æ€§

**å…³é”®æ–‡ä»¶ï¼š**

- `eslint.config.js` - ESLint ä¸»é…ç½®æ–‡ä»¶
- `package.json` - æ›´æ–°çš„è„šæœ¬å‘½ä»¤
- `.editorconfig` - ç¼–è¾‘å™¨é…ç½®ï¼ˆä¿æŒä¸€è‡´æ€§ï¼‰

**è¿ç§»æ•ˆæœï¼š**

- âœ… æ›´å¥½çš„ IDE é›†æˆå’Œæ’ä»¶æ”¯æŒ
- âœ… æ›´ä¸°å¯Œçš„è§„åˆ™é…ç½®å’Œè‡ªå®šä¹‰é€‰é¡¹
- âœ… ä¸å‰ç«¯ç”Ÿæ€ç³»ç»Ÿçš„æ›´å¥½å…¼å®¹æ€§
- âœ… å›¢é˜Ÿåä½œæ—¶çš„ç»Ÿä¸€ä»£ç é£æ ¼

## ç›¸å…³é“¾æ¥

- [é¡¹ç›® README](./README.md)
- [éƒ¨ç½²æŒ‡å—](./DEPLOYMENT.md)
- [é¡¹ç›®ç»“æ„è¯´æ˜](./PROJECT_STRUCTURE.md)
- [Drizzle é…ç½®è¯´æ˜](./DRIZZLE_SETUP.md)
- [Nuxt 4 å®˜æ–¹æ–‡æ¡£](https://nuxt.com/)
- [shadcn-vue ç»„ä»¶åº“](https://www.shadcn-vue.com/)
- [tRPC æ–‡æ¡£](https://trpc.io/)
